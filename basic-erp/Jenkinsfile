pipeline {
    agent any

    environment {
        dockerRegistry = "index.docker.io/v1/"
        dockerCreds = credentials('dockerhub-credentials') // Reference the ID of your Jenkins credentials here
        backendImage = 'thepurplexe/mern-backend'
        frontendImage = 'thepurplexe/mern-frontend'
    }

    stages {
        stage('Build Backend') {
            steps {
                script {
                    def backendPath = "basic-erp/backend"
                    if (fileExists(backendPath)) {
                        // Build Docker image
                        bat "docker build -t thepurplexe/mern-backend ${backendPath}"
                    } else {
                        error "Backend directory ${backendPath} not found"
                    }
                }
            }
        }

        stage('Build Frontend') {
            steps {
                script {
                    def frontendPath = "basic-erp/frontend"
                    if (fileExists(frontendPath)) {
                        bat "docker build -t ${frontendImage}:latest ${frontendPath}"
                    } else {
                        error "Frontend directory ${frontendPath} not found"
                    }
                }
            }
        }

        stage('Push Backend') {
            steps {
                script {
                    docker.withRegistry('https://index.docker.io/v1/', 'dockerhub-credentials') {
                        bat "docker push ${backendImage}:latest"
                    }
                }
            }
        }

        stage('Push Frontend') {
            steps {
                script {
                    docker.withRegistry('https://index.docker.io/v1/', 'dockerhub-credentials') {
                        bat "docker push ${frontendImage}:latest"
                    }
                }
            }
        }
    }
}
